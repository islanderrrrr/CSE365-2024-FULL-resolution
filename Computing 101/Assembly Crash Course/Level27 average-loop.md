# 挑战简介
现在，我们将在每次运行之前动态地在内存中设置一些值。每次运行时，这些值都会发生变化。这意味着您需要对寄存器执行某种类型的公式运算。我们会告诉您哪些寄存器是预先设置的，以及您应该将结果放在哪里。在大多数情况下，它是 rax。

在这一级别中，您将使用控制流操作。这涉及使用指令间接和直接控制特殊寄存器 rip，即指令指针。您将使用 jmp、call、cmp 等指令及其替代指令来实现请求的行为。

在上一个级别中，您计算​​了 4 个整数四字的平均值，这是要计算的固定数量。但是您如何处理程序运行时获得的大小？

在大多数编程语言中，存在一种称为 for 循环的结构，它允许您在有限的次数内执行一组指令。有限的数量可以在程序运行之前或期间知道，其中“在期间”表示值是动态提供给您的。

例如，for 循环可用于计算 1 到 n 的数字之和：
```
sum = 0
i = 1
while i <= n:
sum += i
i += 1
```
请计算 n 个连续四字的平均值，其中：

rdi = 第一个四字的内存地址.   
rsi = n（循环量)  
rax = 计算的平均值  

# 思路
用汇编语言进行平均数计算，有以下几点：
- 你需要一个储存累加数的值，储存数数量的值
- 每个4字的偏移量是8个字节

```
section .text
    global _start

_start:
    xor rdx, rdx            ; 清空 rdx，作为总和累加器
    mov rcx, rsi            ; 将 n 的值（rsi）拷贝到 rcx，保留 rsi 原值以便后续除法使用

loop_start:
    cmp rcx, 0              ; 检查是否已经累加 n 次
    je calculate_average     ; 如果 rcx 为 0，跳转到计算平均值
    add rdx, [rdi]           ; 将当前地址的四字加到 rdx
    add rdi, 8               ; 移动 rdi 到下一个四字
    dec rcx                  ; 递减 rcx 计数器
    jmp loop_start           ; 跳转回循环开始

calculate_average:
    mov rax, rdx             ; 将总和放到 rax 中
    cqo                       ; 将 rax 扩展为 128 位，以准备除法
    idiv rsi                  ; 使用 rsi（原始 n 值）进行带符号除法
    ; 此时 rax 中包含平均值

    ; 程序执行结束后的代码可以是退出系统调用
```
